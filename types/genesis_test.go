package types

import (
	"encoding/base64"
	"fmt"
	"testing"

	"github.com/algorand/go-algorand-sdk/encoding/json"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
)

func TestEncodeDecodeGenesis(t *testing.T) {
	genesisStr := "{\n  \"alloc\": [\n    {\n      \"addr\": \"737777777777777777777777777777777777777777777777777UFEJ2CI\",\n      \"comment\": \"RewardsPool\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"Y76M3MSY6DKBRHBL7C3NNDXGS5IIMQVQVUAB6MP4XEMMGVF2QWNPL226CA\",\n      \"comment\": \"FeeSink\",\n      \"state\": {\n        \"algo\": 1000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"ALGORANDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIN5DNAU\",\n      \"comment\": \"A BIT DOES E NOT BUT E STARTS EVERYTHING LIFE A MANY FORTUNE R BUILD SIMPLER BE THE STARTS PERSEVERES FAVORS A ENOUGH RIPROVANDO POSSIBLE JOURNEY VICTORIA HE BOLD U WITHOUT MEN A K OF BORDERS WHO HE E RACES TOMORROW BUT WHO SINGLE PURPOSE GEOGRAPHICAL PROVANDO A KNOW SUFFOCATES NOT SCIENCE STEP MATHEMATICS OF OR A BRIDGES WALLS TECHNOLOGY TODAY AND WITH AS ET MILES OF THOUSAND VITA SIMPLE TOO MUST AS NOT MADE NOT\",\n      \"state\": {\n        \"algo\": 1000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"XQJEJECPWUOXSKMIC5TCSARPVGHQJIIOKHO7WTKEPPLJMKG3D7VWWID66E\",\n      \"comment\": \"AlgorandCommunityAnnouncement\",\n      \"state\": {\n        \"algo\": 10000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"VCINCVUX2DBKQ6WP63NOGPEAQAYGHGSGQX7TSH4M5LI5NBPVAGIHJPMIPM\",\n      \"comment\": \"AuctionsMaster\",\n      \"state\": {\n        \"algo\": 1000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"OGP6KK5KCMHT4GOEQXJ4LLNJ7D6P6IH7MV5WZ5EX4ZWACHP75ID5PPEE5E\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"AYBHAG2DAIOG26QEV35HKUBGWPMPOCCQ44MQEY32UOW3EXEMSZEIS37M2U\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"2XKK2L6HOBCYHGIGBS3N365FJKHS733QOX42HIYLSBARUIJHMGQZYAQDRY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"ZBSPQQG7O5TR5MHPG3D5RS2TIFFD5NMOPR77VUKURMN6HV2BSN224ZHKGU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"7NQED6NJ4NZU7B5HGGFU2ZEC2UZQYU2SA5S4QOE2EXBVAR4CNAHIXV2XYY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"RX2ZKVJ43GNYDJNIOB6TIX26U7UEQFUQY46OMHX6CXLMMBHENJIH4YVLUQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"RHSKYCCZYYQ2BL6Z63626YUETJMLFGVVV47ED5D55EKIK4YFJ5DQT5CV4A\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"RJS6FDZ46ZZJIONLMMCKDJHYSJNHHAXNABMAVSGH23ULJSEAHZC6AQ6ALE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"AZ2KKAHF2PJMEEUVN4E2ILMNJCSZLJJYVLBIA7HOY3BQ7AENOVVTXMGN3I\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"CGUKRKXNMEEOK7SJKOGXLRWEZESF24ELG3TAW6LUF43XRT2LX4OVQLU4BQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 300000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"VVW6BVYHBG7MZQXKAR3OSPUZVAZ66JMQHOBMIBJG6YSPR7SLMNAPA7UWGY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 250000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"N5BGWISAJSYT7MVW2BDTTEHOXFQF4QQH4VKSMKJEOA4PHPYND43D6WWTIU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 1740000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"MKT3JAP2CEI5C4IX73U7QKRUF6JR7KPKE2YD6BLURFVPW6N7CYXVBSJPEQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 158000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"GVCPSWDNSL54426YL76DZFVIZI5OIDC7WEYSJLBFFEQYPXM7LTGSDGC4SA\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 49998988000000,\n        \"onl\": 1,\n        \"sel\": \"lZ9z6g0oSlis/8ZlEyOMiGfX0XDUcObfpJEg5KjU0OA=\",\n        \"vote\": \"Kk+5CcpHWIXSMO9GiAvnfe+eNSeRtpDb2telHb6I1EE=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"M7XKTBQXVQARLS7IVS6NVDHNLJFIAXR2CGGZTUDEKRIHRVLWL5TJFJOL5U\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 1,\n        \"sel\": \"Z5gE/m2E/WSuaS5E8aYzO2DugTdSWQdc5W5BroCJdms=\",\n        \"vote\": \"QHHw03LnZQhKvjjIxVj3+qwgohOij2j3TBDMy7V9JMk=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"QFYWTHPNZBKKZ4XG2OWVNEX6ETBISD2VJZTCMODIZKT3QHQ4TIRJVEDVV4\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 1,\n        \"sel\": \"NthIIUyiiRVnU/W13ajFFV4EhTvT5EZR/9N6ZRD/Z7U=\",\n        \"vote\": \"3KtiTLYvHJqa+qkGFj2RcZC77bz9yUYKxBZt8B24Z+c=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"DPOZQ6HRYLNNWVQL3I4XV4LMK5UZVROKGJBRIYIRNZUBMVHCU4DZWDBHYE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 1,\n        \"sel\": \"PBZ/agWgmwMdmWgt/W0NvdTN/XSTrVhPvRSMjmP5j90=\",\n        \"vote\": \"FDONnMcq1acmIBjJr3vz4kx4Q8ZRZ8oIH8xXRV5c4L8=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"42GALMKS3HMDB24ZPOR237WQ5QDHL5NIRC3KIA4PCKENJZAD5RP5QPBFO4\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 1,\n        \"sel\": \"p7axjoy3Wn/clD7IKoTK2Zahc5ZU+Qkt2POVHKugQU4=\",\n        \"vote\": \"PItHHw+b01XplxRBFmZniqmdm+RyJFYd0fDz+OP4D6o=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"OXWIMTRZA5TVPABJF534EBBERJG367OLAB6VFN4RAW5P6CQEMXEX7VVDV4\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 1,\n        \"sel\": \"RSOWYRM6/LD7MYxlZGvvF+WFGmBZg7UUutdkaWql0Xo=\",\n        \"vote\": \"sYSYFRL7AMJ61egushOYD5ABh9p06C4ZRV/OUSx7o3g=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"AICDUO6E46YBJRLM4DFJPVRVZGOFTRNPF7UPQXWEPPYRPVGIMQMLY5HLFM\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 1,\n        \"sel\": \"0vxjPZqEreAhUt9PHJU2Eerb7gBhMU+PgyEXYLmbifg=\",\n        \"vote\": \"fuc0z/tpiZXBWARCJa4jPdmDvSmun4ShQLFiAxQkOFI=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"DYATVHCICZA7VVOWZN6OLFFSKUAZ64TZ7WZWCJQBFWL3JL4VBBV6R7Z6IE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 1,\n        \"sel\": \"KO2035CRpp1XmVPOTOF6ICWCw/0I6FgelKxdwPq+gMY=\",\n        \"vote\": \"rlcoayAuud0suR3bvvI0+psi/NzxvAJUFlp+I4ntzkM=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"6XJH2PJMAXWS4RGE6NBYIS3OZFOPU3LOHYC6MADBFUAALSWNFHMPJUWVSE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 1,\n        \"sel\": \"PgW1dncjs9chAVM89SB0FD4lIrygxrf+uqsAeZw8Qts=\",\n        \"vote\": \"pA4NJqjTAtHGGvZWET9kliq24Go5kEW8w7f1BGAWmKY=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"EYOZMULFFZZ5QDDMWQ64HKIMUPPNEL3WJMNGAFD43L52ZXTPESBEVJPEZU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 1,\n        \"sel\": \"sfebD2noAbrn1vblMmeCIeGB3BxLGKQDTG4sKSNibFs=\",\n        \"vote\": \"Cuz3REj26J+JhOpf91u6PO6MV5ov5b1K/ii1U1uPD/g=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"I3345FUQQ2GRBHFZQPLYQQX5HJMMRZMABCHRLWV6RCJYC6OO4MOLEUBEGU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"MkH9KsdwiFgYtFFWFu48CeejEop1vsyGFG4/kqPIOFg=\",\n        \"vote\": \"RcntidhQqXQIvYjLFtc6HuL335rMnNX92roa2LcC+qQ=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"6LQH42A4QJ3Y27FGKJWERY3MD65SXM4QQCJJR2HRJYNB427IQ73YBI3YFY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"nF3mu9Bu0Ad5MIrT31NgTxxrsZOXc4u1+WCvaPQTYEQ=\",\n        \"vote\": \"NaqWR/7FzOq/MiHb3adO6+J+kvnQKat8NSqEmoEkVfE=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"3V2MC7WJGAFU2EHWBHEETIMJVFJNAT4KKWVPOMJFJIM6ZPWEJRJ4POTXGI\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"3i4K8zdmnf1kxwgcNmI3x50iIwAxDmLMvoQEhjzhado=\",\n        \"vote\": \"wfJWa0kby76rqX2yvCD/aCfJdNt+qItylDPQiuAWFkQ=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"FTXSKED23VEXNW442T2JKNPPNUC2WKFNRWBVQTFMT7HYX365IVLZXYILAI\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"icuL7ehcGonAcJ02Zy4MIHqcT+Sp1R1UURNCYJQHmo4=\",\n        \"vote\": \"tmFcj3v7X5DDxKI1IDbGdhXh3a5f0Ab1ftltM7TgIDE=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"IAOW7PXLCDGLKMIQF26IXFF4THSQMU662MUU6W5KPOXHIVKHYFLYRWOUT4\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"zTn9rl/8Y2gokMdFyFP/pKg4eP02arkxlrBZIS94vPI=\",\n        \"vote\": \"a0pX68GgY7u8bd2Z3311+Mtc6yDnESZmi9k8zJ0oHzY=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"4NRNE5RIGC2UGOMGMDR6L5YMQUV3Q76TPOR7TDU3WEMJLMC6BSBEKPJ2SY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"orSV2VHPY8m5ckEHGwK0r+SM9jq4BujAICXegAUAecI=\",\n        \"vote\": \"NJ9tisH+7+S29m/uMymFTD8X02/PKU0JUX1ghnLCzkw=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"E2EIMPLDISONNZLXONGMC33VBYOIBC2R7LVOS4SYIEZYJQK6PYSAPQL7LQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"XM2iW9wg9G5TyOfVu9kTS80LDIqcEPkJsgxaZll3SWA=\",\n        \"vote\": \"p/opFfDOsIomj5j7pAYU+G/CNUIwvD2XdEer6dhGquQ=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"APDO5T76FB57LNURPHTLAGLQOHUQZXYHH2ZKR4DPQRKK76FB4IAOBVBXHQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"5k2vclbUQBE6zBl45F3kGSv1PYhE2k9wZjxyxoPlnwA=\",\n        \"vote\": \"3dcLRSckm3wd9KB0FBRxub3meIgT6lMZnv5F08GJgEo=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"3KJTYHNHK37G2JDZJPV55IHBADU22TX2FPJZJH43MY64IFWKVNMP2F4JZE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"o5e9VLqMdmJas5wRovfYFHgQ+Z6sQoATf3a6j0HeIXU=\",\n        \"vote\": \"rG7J8pPAW+Xtu5pqMIJOG9Hxdlyewtf9zPHEKR2Q6OE=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"IVKDCE6MS44YVGMQQFVXCDABW2HKULKIXMLDS2AEOIA6P2OGMVHVJ64MZI\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"XgUrwumD7oin/rG3NKwywBSsTETg/aWg9MjCDG61Ybg=\",\n        \"vote\": \"sBPEGGrEqcQMdT+iq2ududNxCa/1HcluvsosO1SkE/k=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"2WDM5XFF7ONWFANPE5PBMPJLVWOEN2BBRLSKJ37PQYW5WWIHEFT3FV6N5Y\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"Lze5dARJdb1+Gg6ui8ySIi+LAOM3P9dKiHKB9HpMM6A=\",\n        \"vote\": \"ys4FsqUNQiv+N0RFtr0Hh9OnzVcxXS6cRVD/XrLgW84=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"EOZWAIPQEI23ATBWQ5J57FUMRMXADS764XLMBTSOLVKPMK5MK5DBIS3PCY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"jtmLcJhaAknJtA1cS5JPZil4SQ5SKh8P0w1fUw3X0CE=\",\n        \"vote\": \"pyEtTxJAas/j+zi/N13b/3LB4UoCar1gfcTESl0SI2I=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"REMF542E5ZFKS7SGSNHTYB255AUITEKHLAATWVPK3CY7TAFPT6GNNCHH6M\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"8ggWPvRpSkyrjxoh1SVS9PiSjff2azWtH0HFadwI9Ck=\",\n        \"vote\": \"Ej/dSkWbzRf09RAuWZfC4luRPNuqkLFCSGYXDcOtwic=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"T4UBSEAKK7JHT7RNLXVHDRW72KKFJITITR54J464CAGE5FGAZFI3SQH3TI\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"eIB8MKaG2lyJyM9spk+b/Ap/bkbo9bHfvF9f8T51OQk=\",\n        \"vote\": \"7xuBsE5mJaaRAdm5wnINVwm4SgPqKwJTAS1QBQV3sEc=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"YUDNQMOHAXC4B3BAMRMMQNFDFZ7GYO2HUTBIMNIP7YQ4BL57HZ5VM3AFYU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"CSTCDvvtsJB0VYUcl3oRXyiJfhm3CtqvRIuFYZ69Z68=\",\n        \"vote\": \"uBK1TH4xKdWfv5nnnHkvYssI0tyhWRFZRLHgVt9TE1k=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"4SZTEUQIURTRT37FCI3TRMHSYT5IKLUPXUI7GWC5DZFXN2DGTATFJY5ABY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"THGOlrqElX13xMqeLUPy6kooTbXjiyrUoZfVccnHrfI=\",\n        \"vote\": \"k4hde2Q3Zl++sQobo01U8heZd/X0GIX1nyqM8aI/hCY=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"UEDD34QFEMWRGYCBLKZIEHPKSTNBFSRMFBHRJPY3O2JPGKHQCXH4IY6XRI\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"jE+AUFvtp2NJsfNeUZeXdWt0X6I58YOgY+z/HB17GDs=\",\n        \"vote\": \"lmnYTjg1FhRNAR9TwVmOahVr5Z+7H1GO6McmvOZZRTQ=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"HHZQOGQKMQDLBEL3HXMDX7AGTNORYVZ4JFDWVSL5QLWMD3EXOIAHDI5L7M\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"Hajdvzem2rR2GjLmCG+98clHZFY5Etlp0n+x/gQTGj0=\",\n        \"vote\": \"2+Ie4MDWC6o/SfFSqev1A7UAkzvKRESI42b4NKS6Iw8=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"XRTBXPKH3DXDJ5OLQSYXOGX3DJ3U5NR6Y3LIVIWMK7TY33YW4I2NJZOTVE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"5qe7rVoQfGdIUuDbhP2ABWivCoCstKbUsjdmYY76akA=\",\n        \"vote\": \"3J3O9DyJMWKvACubUK9QvmCiArtZR7yFHWG7k7+apdQ=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"JJFGCPCZPYRLOUYBZVC4F7GRPZ5CLB6BMTVRGNDP7GRGXL6GG4JEN7DL54\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 24000000000000,\n        \"onl\": 1,\n        \"sel\": \"YoRFAcTiOgJcLudNScYstbaKJ8anrrHwQMZAffWMqYE=\",\n        \"vote\": \"VQFKlDdxRqqqPUQ/mVoF8xZS9BGxUtTnPUjYyKnOVRA=\",\n        \"voteKD\": 10000,\n        \"voteLst\": 3000000\n      }\n    },\n    {\n      \"addr\": \"4VNSA2GZVUD5ZNO62OVVNP4NEL2LIEE5N3MZEK4BKH62KGKRLVINFZYTZM\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 100000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"IVCEEIH2Q32DZNRTS5XFVEFFAQGERNZHHQT6S4UPY7ORJMHIQDSTX7YM4E\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 408400000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"PLFHBIRGM3ZWGAMCXTREX2N537TWOMFIQXHFO2ZGQOEPZU473SYBVGVA5M\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 1011600000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"KF7X4ZABZUQU7IFMHSKLDKWCS4F3GZLOLJRDAK5KMEMDAGU32CX36CJQ5M\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"BTEESEYQMFLWZKULSKLNDELYJTOOQK6ZT4FBCW3TOZQ55NZYLOO6BRQ5K4\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 36199095000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"E36JOZVSZZDXKSERASLAWQE4NU67HC7Q6YDOCG7P7IRRWCPSWXOI245DPA\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 20000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"I5Q6RRN44OZWYMX6YLWHBGEVPL7S3GBUCMHZCOOLJ245TONH7PERHJXE4A\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 20000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"2GYS272T3W2AP4N2VX5BFBASVNLWN44CNVZVKLWMMVPZPHVJ52SJPPFQ2I\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"D5LSV2UGT4JJNSLJ5XNIF52WP4IHRZN46ZGWH6F4QEF4L2FLDYS6I6R35Y\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 20000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"UWMSBIP2CGCGR3GYVUIOW3YOMWEN5A2WRTTBH6Y23KE3MOVFRHNXBP6IOE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 20000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"OF3MKZZ3L5ZN7AZ46K7AXJUI4UWJI3WBRRVNTDKYVZUHZAOBXPVR3DHINE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"2PPWE36YUMWUVIFTV2A6U4MLZLGROW4GHYIRVHMUCHDH6HCNVPUKPQ53NY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 440343426000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"JRGRGRW4HYBNAAHR7KQLLBAGRSPOYY6TRSINKYB3LI5S4AN247TANH5IQY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 362684706000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"D7YVVQJXJEFOZYUHJLIJBW3ATCAW46ML62VYRJ3SMGLOHMWYH4OS3KNHTU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"PZJKH2ILW2YDZNUIYQVJZ2MANRSMK6LCHAFSAPYT6R3L3ZCWKYRDZXRVY4\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"3MODEFJVPGUZH3HDIQ6L2MO3WLJV3FK3XSWKFBHUGZDCHXQMUKD4B7XLMI\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 130000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"WNSA5P6C5IIH2UJPQWJX6FRNPHXY7XZZHOWLSW5ZWHOEHBUW4AD2H6TZGM\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 130000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"OO65J5AIFDS6255WL3AESTUGJD5SUV47RTUDOUGYHEIME327GX7K2BGC6U\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"DM6A24ZWHRZRM2HWXUHAUDSAACO7VKEZAOC2THWDXH4DX5L7LSO3VF2OPU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 20000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"NTJJSFM75RADUOUGOBHZB7IJGO7NLVBWA66EYOOPU67H7LYIXVSPSI7BTA\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 18099548000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"DAV2AWBBW4HBGIL2Z6AAAWDWRJPTOQD6BSKU2CFXZQCOBFEVFEJ632I2LY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 1000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"M5VIY6QPSMALVVPVG5LVH35NBMH6XJMXNWKWTARGGTEEQNQ3BHPQGYP5XU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 20000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"WZZLVKMCXJG3ICVZSVOVAGCCN755VHJKZWVSVQ6JPSRQ2H2OSPOOZKW6DQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 45248869000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"XEJLJUZRQOLBHHSOJJUE4IWI3EZOM44P646UDKHS4AV2JW7ZWBWNFGY6BU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 20000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"OGIPDCRJJPNVZ6X6NBQHMTEVKJVF74QHZIXVLABMGUKZWNMEH7MNXZIJ7Q\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"G47R73USFN6FJJQTI3JMYQXO7F6H4LRPBCTTAD5EZWPWY2WCG64AVPCYG4\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"PQ5T65QB564NMIY6HXNYZXTFRSTESUEFIF2C26ZZKIZE6Q4R4XFP5UYYWI\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 5000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"R6S7TRMZCHNQPKP2PGEEJ6WYUKMTURNMM527ZQXABTHFT5GBVMF6AZAL54\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 1000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"36LZKCBDUR5EHJ74Q6UWWNADLVJOHGCPBBQ5UTUM3ILRTQLA6RYYU4PUWQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 5000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"JRHPFMSJLU42V75NTGFRQIALCK6RHTEK26QKLWCH2AEEAFNAVEXWDTA5AM\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"64VZVS2LFZXWA5W3S657W36LWGP34B7XLMDIF4ROXBTPADD7SR5WNUUYJE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 171945701000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"TXDBSEZPFP2UB6BDNFCHCZBTPONIIQVZGABM4UBRHVAAPR5NE24QBL6H2A\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 60000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"XI5TYT4XPWUHE4AMDDZCCU6M4AP4CAI4VTCMXXUNS46I36O7IYBQ7SL3D4\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"Y6ZPKPXF2QHF6ULYQXVHM7NPI3L76SP6QHJHK7XTNPHNXDEUTJPRKUZBNE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"6LY2PGUJLCK4Q75JU4IX5VWVJVU22VGJBWPZOFP3752UEBIUBQRNGJWIEA\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"L7AGFNAFJ6Z2FYCX3LXE4ZSERM2VOJF4KPF7OUCMGK6GWFXXDNHZJBEC2E\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"RYXX5U2HMWGTPBG2UDLDT6OXDDRCK2YGL7LFAKYNBLRGZGYEJLRMGYLSVU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"S263NYHFQWZYLINTBELLMIRMAJX6J5CUMHTECTGGVZUKUN2XY6ND2QBZVY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 21647524000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"AERTZIYYGK3Q364M6DXPKSRRNSQITWYEDGAHXC6QXFCF4GPSCCSISAGCBY\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 19306244000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"34UYPXOJA6WRTWRNH5722LFDLWT23OM2ZZTCFQ62EHQI6MM3AJIAKOWDVQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"EDVGNQL6APUFTIGFZHASIEWGJRZNWGIKJE64B72V36IQM2SJPOAG2MJNQE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 20000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"RKKLUIIGR75DFWGQOMJB5ZESPT7URDPC7QHGYKM4MAJ4OEL2J5WAQF6Z2Q\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"M4TNVJLDZZFAOH2M24BE7IU72KUX3P6M2D4JN4WZXW7WXH3C5QSHULJOU4\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"WQL6MQS5SPK3CR3XUPYMGOUSCUC5PNW5YQPLGEXGKVRK3KFKSAZ6JK4HXQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"36JTK4PKUBJGVCWKXZTAG6VLJRXWZXQVPQQSYODSN6WEGVHOWSVK6O54YU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"YFOAYI4SNXJR2DBEZ3O6FJOFSEQHWD7TYROCNDWF6VLBGLNJMRRHDXXZUI\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 30000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"XASOPHD3KK3NNI5IF2I7S7U55RGF22SG6OEICVRMCTMMGHT3IBOJG7QWBU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"H2AUGBLVQFHHFLFEPJ6GGJ7PBQITEN2GE6T7JZCALBKNU7Q52AVJM5HOYU\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"GX3XLHSRMFTADVKJBBQBTZ6BKINW6ZO5JHXWGCWB4CPDNPDQ2PIYN4AVHQ\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"VBJBJ4VC3IHUTLVLWMBON36Y5MPAMPV4DNGW5FQ47GRLPT7JR5PQOUST2E\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 4524887000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"7AQVTOMB5DJRSUM4LPLVF6PY3Y5EBDF4RZNDIWNW4Z63JYTAQCPQ62IZFE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 50000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"B4ZIHKD4VYLA4BAFEP7KUHZD7PNWXW4QLCHCNKWRENJ2LYVEOIYA3ZX6IA\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 40000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"G5RGT3EENES7UVIQUHXMJ5APMOGSW6W6RBC534JC6U2TZA4JWC7U27RADE\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 10000000000000,\n        \"onl\": 2\n      }\n    },\n    {\n      \"addr\": \"5AHJFDLAXVINK34IGSI3JA5OVRVMPCWLFEZ6TA4I7XUZ7I6M34Q56DUYIM\",\n      \"comment\": \"\",\n      \"state\": {\n        \"algo\": 20000000000000,\n        \"onl\": 2\n      }\n    }\n  ],\n  \"fees\": \"Y76M3MSY6DKBRHBL7C3NNDXGS5IIMQVQVUAB6MP4XEMMGVF2QWNPL226CA\",\n  \"id\": \"v1.0\",\n  \"network\": \"mainnet\",\n  \"proto\": \"https://github.com/algorandfoundation/specs/tree/5615adc36bad610c7f165fa2967f4ecfa75125f0\",\n  \"rwd\": \"737777777777777777777777777777777777777777777777777UFEJ2CI\",\n  \"timestamp\": 1560211200\n}"
	var genesis Genesis
	err := json.Decode([]byte(genesisStr), &genesis)
	assert.NoError(t, err)
	assert.Equal(t, base64.StdEncoding.EncodeToString(json.Encode(genesis)), base64.StdEncoding.EncodeToString([]byte(genesisStr)))
	// hash value taken from https://developer.algorand.org/docs/get-details/algorand-networks/mainnet/#genesis-hash
	expectedHash := "wGHE2Pwdvd7S12BL5FaOP20EGYesN73ktiC1qzkkit8="
	gh := genesis.Hash()
	b := gh[:]
	assert.Equal(t, base64.StdEncoding.EncodeToString(b), expectedHash)
}

func TestGenesis_Balances(t *testing.T) {
	containsErrorFunc := func(str string) assert.ErrorAssertionFunc {
		return func(_ assert.TestingT, err error, i ...interface{}) bool {
			require.ErrorContains(t, err, str)
			return true
		}
	}
	mustAddr := func(addr string) Address {
		address, err := DecodeAddress(addr)
		require.NoError(t, err)
		return address
	}
	makeAddr := func(addr uint64) Address {
		var address Address
		address[0] = byte(addr)
		return address
	}
	acctWith := func(algos uint64, addr string) GenesisAllocation {
		return GenesisAllocation{
			_struct: struct{}{},
			Address: addr,
			Comment: "",
			State: Account{
				MicroAlgos: algos,
			},
		}
	}
	goodAddr := makeAddr(100)
	allocation1 := acctWith(1000, makeAddr(1).String())
	allocation2 := acctWith(2000, makeAddr(2).String())
	badAllocation := acctWith(1234, "El Toro Loco")
	type fields struct {
		Allocation  []GenesisAllocation
		FeeSink     string
		RewardsPool string
	}
	tests := []struct {
		name    string
		fields  fields
		want    GenesisBalances
		wantErr assert.ErrorAssertionFunc
	}{
		{
			name: "basic test",
			fields: fields{
				Allocation:  []GenesisAllocation{allocation1},
				FeeSink:     goodAddr.String(),
				RewardsPool: goodAddr.String(),
			},
			want: GenesisBalances{
				Balances: map[Address]Account{
					mustAddr(allocation1.Address): allocation1.State,
				},
				FeeSink:     goodAddr,
				RewardsPool: goodAddr,
				Timestamp:   0,
			},
			wantErr: assert.NoError,
		},
		{
			name: "two test",
			fields: fields{
				Allocation:  []GenesisAllocation{allocation1, allocation2},
				FeeSink:     goodAddr.String(),
				RewardsPool: goodAddr.String(),
			},
			want: GenesisBalances{
				Balances: map[Address]Account{
					mustAddr(allocation1.Address): allocation1.State,
					mustAddr(allocation2.Address): allocation2.State,
				},
				FeeSink:     goodAddr,
				RewardsPool: goodAddr,
				Timestamp:   0,
			},
			wantErr: assert.NoError,
		},
		{
			name: "bad fee sink",
			fields: fields{
				Allocation:  []GenesisAllocation{allocation1, allocation2},
				RewardsPool: goodAddr.String(),
			},
			wantErr: containsErrorFunc("cannot parse fee sink addr"),
		},
		{
			name: "bad rewards pool",
			fields: fields{
				Allocation: []GenesisAllocation{allocation1, allocation2},
				FeeSink:    goodAddr.String(),
			},
			wantErr: containsErrorFunc("cannot parse rewards pool addr"),
		},
		{
			name: "bad genesis addr",
			fields: fields{
				Allocation:  []GenesisAllocation{badAllocation},
				FeeSink:     goodAddr.String(),
				RewardsPool: goodAddr.String(),
			},
			wantErr: containsErrorFunc("cannot parse genesis addr"),
		},
		{
			name: "repeat address",
			fields: fields{
				Allocation:  []GenesisAllocation{allocation1, allocation1},
				FeeSink:     goodAddr.String(),
				RewardsPool: goodAddr.String(),
			},
			wantErr: containsErrorFunc("repeated allocation to"),
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			genesis := Genesis{
				Allocation:  tt.fields.Allocation,
				FeeSink:     tt.fields.FeeSink,
				RewardsPool: tt.fields.RewardsPool,
			}
			got, err := genesis.Balances()
			if tt.wantErr(t, err, fmt.Sprintf("Balances()")) {
				return
			}
			assert.Equalf(t, tt.want, got, "Balances()")
		})
	}
}
